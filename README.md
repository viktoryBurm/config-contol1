# Эмулятор командной строки UNIX

Этот проект представляет собой эмулятор командной строки UNIX-подобной операционной системы с поддержкой виртуальной файловой системы (VFS), выполнения скриптов и основных команд оболочки. Все операции выполняются в памяти без изменения файловой системы хоста.

## Общее описание

Эмулятор реализует REPL (Read-Eval-Print Loop) цикл, имитирующий работу стандартной UNIX-оболочки. Поддерживается:

- Интерактивный режим с приглашением в формате `username@hostname:current_dir$`
- Парсинг команд с корректной обработкой кавычек и аргументов
- Виртуальная файловая система (VFS), загружаемая из JSON-файла
- Выполнение команд из стартового скрипта
- Основные команды: `ls`, `cd`, `cat`, `pwd`, `echo`, `wc`, `du`, `tree`, `cp`, `exit`

Все модификации файловой системы происходят только в памяти и не влияют на реальную файловую систему хоста.

## Функции и настройки

### Поддерживаемые команды

| Команда | Описание | Примеры использования |
|---------|----------|----------------------|
| `ls [путь]` | Список содержимого директории | `ls`, `ls /home` |
| `cd [путь]` | Смена текущей директории | `cd /home/user`, `cd ..` |
| `cat файл...` | Вывод содержимого файла(ов) | `cat file.txt`, `cat file1.txt file2.txt` |
| `pwd` | Показ текущего пути в VFS | `pwd` |
| `echo аргументы...` | Вывод аргументов (для демонстрации) | `echo hello world` |
| `wc файл...` | Подсчет строк, слов и байтов в файле(ах) | `wc file.txt` |
| `du [путь]` | Размер директории или файла в байтах | `du`, `du /home` |
| `tree [путь]` | Древовидное представление структуры директории | `tree`, `tree /home` |
| `cp источник назначение` | Копирование файла | `cp file1.txt file2.txt` |
| `exit` | Выход из эмулятора | `exit` |

### Параметры командной строки

При запуске эмулятора можно указать следующие параметры:

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `--vfs-path ПУТЬ` | Путь к JSON-файлу с описанием виртуальной файловой системы | Создается VFS по умолчанию |
| `--startup-script ПУТЬ` | Путь к файлу скрипта для автоматического выполнения при запуске | Не выполняется |

### Особенности VFS

- VFS хранится полностью в памяти
- Поддержка вложенных директорий (неограниченная глубина)
- Файлы могут содержать текстовые данные или данные в формате base64 (префикс `base64:`)
- Все пути обрабатываются как в UNIX: абсолютные (`/path`) и относительные (`path`), поддержка `.` и `..`
- При отсутствии указанного VFS-файла создается минимальная VFS по умолчанию

## Сборка и запуск

Проект написан на Python и не требует компиляции. Для запуска необходим Python 3.6+.

### Установка зависимостей

Проект использует только стандартную библиотеку Python, дополнительные зависимости не требуются.

### Запуск эмулятора

```bash
# Запуск в интерактивном режиме с VFS по умолчанию
python main.py

# Запуск с указанием VFS-файла
python main.py --vfs-path test_vfs.json

# Запуск с выполнением стартового скрипта
python main.py --startup-script test_basic.txt

# Комбинированный запуск
python main.py --vfs-path test_vfs.json --startup-script test_basic.txt
```

### Запуск тестов

Для запуска тестового сценария используйте предоставленный скрипт:

**Windows** (`run_test.bat`):
```bat
python main.py --vfs-path test_vfs.json --startup-script test_basic.txt
```

Запуск:
```cmd
run_test.bat
```

## Примеры использования

### Пример 1: Базовое взаимодействие

```bash
user@localhost:/$ ls
home
etc
user@localhost:/$ cd home
user@localhost:home$ ls
user
user@localhost:home$ cd user
user@localhost:user$ pwd
/home/user
user@localhost:user$ exit
Выход из эмулятора
```

### Пример 2: Работа с файлами

```bash
user@localhost:/$ cat /home/user/documents/file1.txt
Это содержимое file1.txt
user@localhost:/$ wc /home/user/documents/file1.txt
  1  4  28 /home/user/documents/file1.txt
user@localhost:/$ du /home/user/documents
56	/home/user/documents
```

### Пример 3: Использование древовидной структуры

```bash
user@localhost:/$ tree /home
/home
└── user
    ├── documents
    │   ├── file1.txt
    │   └── file2.txt
    └── downloads
        └── archive.zip
```

### Пример 4: Копирование файлов

```bash
user@localhost:/$ cp /home/user/documents/file1.txt /file1_copy.txt
user@localhost:/$ ls /
etc
file1_copy.txt
home
user@localhost:/$ cat /file1_copy.txt
Это содержимое file1.txt
```

### Пример стартового скрипта

Файл `test_basic.txt` содержит последовательность команд для автоматического тестирования:

```text
# Просмотр структуры
ls /
tree /

# Копирование файлов
cp /home/user/documents/file1.txt /file1_copy.txt
cp /home/user/documents/file2.txt /home/file2_copy.txt
cp /etc/config.conf /home/user/config_backup.conf

# Проверка результатов
ls /
ls /home
cat /file1_copy.txt

# Тестирование ошибок
cp /nonexistent.txt /copy.txt
cp /home /home_copy
cp /home/user/documents/file1.txt /etc/config.conf

# Финальная проверка
cd /home/user/documents
cp file1.txt file1_local_copy.txt
ls
tree
du
```

При запуске команды:
```bash
python main.py --vfs-path test_vfs.json --startup-script test_basic.txt
```
эмулятор:

1. Загружает VFS из `test_vfs.json`
2. Последовательно выполняет все команды из `test_basic.txt`
3. Имитирует интерактивную сессию: показывает приглашение + команду → вывод результата
4. Пропускает пустые строки и комментарии (начинающиеся с `#`)
5. Обрабатывает ошибки без остановки выполнения скрипта
6. После завершения скрипта переходит в интерактивный режим (если не вызван `exit`)

Это позволяет полностью автоматизировать тестирование функциональности эмулятора и демонстрировать его возможности в рамках учебного проекта.
